<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perfect Match</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

<style>
html, body {
  height: 100%;
  margin: 0;
  background-color: #AB4A4F;
  font-family: 'Open Sans', sans-serif;
  line-height: 150%;
  letter-spacing: 1.5px;
}

body {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
}

.header {
  width: 100%;
  max-width: 420px;
  display: flex;
  align-items: center;
  margin-bottom: 24px;
}

.header img {
  height: 40px;
}

.header a {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #ffffff;
  font-weight: 600;
  text-decoration: none;
  font-size: 17px;
}

.tool {
  width: 100%;
  max-width: 420px;
  padding: 24px;
  border: 2px solid #ffffff;
  border-radius: 14px;
  background-color: #AB4A4F;
  color: #ffffff;
  box-sizing: border-box;
}

h1 {
  font-size: 20px;
  margin-bottom: 20px;
  text-align: center;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 16px;
  font-size: 15px;
  font-family: 'Open Sans', sans-serif;
  box-sizing: border-box;
}

button {
  background-color: #ffffff;
  color: #AB4A4F;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

#result {
  margin-top: 16px;
  font-size: 13px;
}

.site-link {
  margin-top: 24px;
  font-weight: 600;
  text-align: center;
}

.site-link a {
  color: #ffffff;
  text-decoration: none;
}
</style>
</head>

<body>

<div class="header site-link">
  <a href="https://lifeprediction.net">
    <img src="https://assets.nicepagecdn.com/0b5dbf35/6598838/images/Untitled111.png">
    LIFE PREDICTION
  </a>
</div>

<div class="tool">
  <h1>PERFECT MATCH</h1>

  <label>Your Planet</label>
  <select id="userPlanet">
    <option value="Sun">Sun</option>
    <option value="Moon">Moon</option>
    <option value="Venus">Venus</option>
  </select>

  <label>Your Planet Degree (0–360)</label>
  <input type="number" id="userDegree" min="0" max="360">

  <button onclick="findMatches()">CHECK MATCHES</button>

  <div id="result"></div>

  <div class="site-link">
    <a href="https://lifeprediction.net">LIFEPREDICTION.NET</a>
  </div>
</div>

<script>
const ORB = 8;

function angularDifference(a, b) {
  let diff = Math.abs(a - b);
  if (diff > 180) diff = 360 - diff;
  return diff;
}

function isPerfectMatch(a, b) {
  const d = angularDifference(a, b);
  return Math.abs(d - 0) <= ORB || Math.abs(d - 120) <= ORB;
}

async function findMatches() {
  document.getElementById("result").innerHTML = "Checking matches…";

  const planet = document.getElementById("userPlanet").value;
  const degree = parseFloat(document.getElementById("userDegree").value);

  if (isNaN(degree)) {
    document.getElementById("result").innerHTML = "Please enter a valid degree.";
    return;
  }

  const response = await fetch("ephemeris_3hour_1940_2030.csv");
  const text = await response.text();
  const rows = text.split("\n");

  let matches = [];

  for (let i = 1; i < rows.length; i++) {
    const cols = rows[i].split(",");
    if (cols.length < 4) continue;

    const date = cols[0];
    const sun = parseFloat(cols[1]);
    const moon = parseFloat(cols[2]);
    const venus = parseFloat(cols[3]);

    let otherDegree =
      planet === "Sun" ? venus :
      planet === "Moon" ? venus :
      planet === "Venus" ? sun : null;

    if (otherDegree === null) continue;

    if (isPerfectMatch(degree, otherDegree)) {
      matches.push(date);
    }
  }

  if (matches.length === 0) {
    document.getElementById("result").innerHTML =
      "No perfect matches found in the current date range.";
    return;
  }

  document.getElementById("result").innerHTML =
    "<b>Perfect Matches (UTC birth dates):</b><br><br>" +
    matches.slice(0, 200).join("<br>") +
    "<br><br><i>You will be notified if someone with one of these birth dates joins.</i>";
}
</script>

</body>
</html>
